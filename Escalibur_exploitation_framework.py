# Escalibur Exploitation Framework - HTTP Server

import subprocess
import os
from http.server import BaseHTTPRequestHandler, HTTPServer
import threading

class RequestHandler(BaseHTTPRequestHandler):
    def do_GET(self):
        self.send_response(200)
        self.send_header('Content-type', 'text/html')
        self.end_headers()
        if self.path == '/':
            self.wfile.write(b"<html><body><h1>Welcome to the Escalibur Exploitation Framework</h1></body></html>")
        elif self.path == '/console':
            self.handle_console()
        else:
            self.wfile.write(b"<html><body><h1>Page not found</h1></body></html>")

    def handle_console(self):
        self.send_response(200)
        self.send_header('Content-type', 'text/html')
        self.end_headers()
        self.wfile.write(b"<html><body><h1>Escalibur Console</h1>")
        self.wfile.write(b"<form action='/execute' method='post'>")
        self.wfile.write(b"<input type='text' name='command'>")
        self.wfile.write(b"<input type='submit' value='Execute'>")
        self.wfile.write(b"</form>")
        self.wfile.write(b"</body></html>")

    def do_POST(self):
        content_length = int(self.headers['Content-Length'])
        post_data = self.rfile.read(content_length).decode('utf-8')
        command = post_data.split('=')[1]
        output = self.execute_command(command)
        self.send_response(200)
        self.send_header('Content-type', 'text/html')
        self.end_headers()
        self.wfile.write(output.encode())

    def execute_command(self, command):
        try:
            result = subprocess.check_output(command, shell=True, stderr=subprocess.STDOUT)
            return result.decode()
        except Exception as e:
            return str(e)

class HTTPServerWithConsole(threading.Thread):
    def run(self):
        server_address = ('', 8000)
        httpd = HTTPServer(server_address, RequestHandler)
        print("HTTP Server with Console started on port 8000...")
        httpd.serve_forever()

def main():
    print("Welcome to the Escalibur Exploitation Framework - HTTP Server")
    print("The HTTP server with console is running in the background.")
    print("Access the console at http://localhost:8000/console")
    print("Type 'exit' to stop the HTTP server.")

    http_server_thread = HTTPServerWithConsole()
    http_server_thread.daemon = True
    http_server_thread.start()

    while True:
        user_input = input("> ")
        if user_input.lower() == "exit":
            print("Stopping HTTP Server...")
            break
        else:
            print("Invalid command. Type 'exit' to stop the HTTP server.")

if __name__ == "__main__":
    main()
